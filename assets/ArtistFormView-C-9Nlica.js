import{d as B,n as v,c as N,C as S,o as r,a as o,k as t,y as d,e as b,w as y,z as x,f as u,A as F,r as U,h as k,p as E,j as L,_ as P}from"./index-C3usxq6_.js";import{a as _}from"./artists-D03lRXEJ.js";import{A as R}from"./ArtistFormFields-DIpck_Ir.js";const w=l=>(E("data-v-3c85f639"),l=l(),L(),l),W={class:"artist-form-layout"},T={class:"artist-form-view"},j={class:"form-header"},z={class:"form-group"},D=w(()=>t("label",{for:"image"},"Artist Image",-1)),M=w(()=>t("div",{class:"field-hint"},"Bild: wird resized",-1)),Y={key:0,class:"error"},O={class:"form-actions"},q=["disabled"],G={class:"artist-preview"},H=w(()=>t("h3",{class:"preview-title"},"Preview",-1)),J={class:"artist"},K={class:"accent"},Q=["src"],X=["href"],Z={key:2,class:"video-container"},$=["src"],ee={key:3,class:"bandcamp-container"},te=["src"],ae=B({__name:"ArtistFormView",props:{id:{}},setup(l){const n=l,A=F(),h=!!n.id,e=v({name:"",link:"",description:"",soundcloud:"",youtube:"",bandcamp:""}),m=v(!1),s=v(""),c=v(null),g=N(()=>c.value?URL.createObjectURL(c.value):e.value.image_url||e.value.image||null);async function C(){if(n.id)try{const a=await _.getById(Number(n.id));e.value={...a}}catch{s.value="Failed to load artist"}}function I(a){const i=a.target;i.files&&i.files[0]&&(c.value=i.files[0])}async function V(){if(!e.value.name){s.value="Please enter artist name";return}if(e.value.youtube&&!e.value.youtube.startsWith("https://www.youtube.com/embed/")){s.value="YouTube URL must start with https://www.youtube.com/embed/";return}if(e.value.bandcamp&&!e.value.bandcamp.startsWith("https://bandcamp.com/EmbeddedPlayer")){s.value="Bandcamp URL must start with https://bandcamp.com/EmbeddedPlayer";return}m.value=!0,s.value="";try{let a;const{image:i,image_url:f,...p}=e.value;h?(await _.update(Number(n.id),p),a=Number(n.id)):a=(await _.create(p)).id,c.value&&await _.uploadImage(a,c.value),A.push("/admin/artists")}catch(a){s.value=a.message||"Failed to save artist"}finally{m.value=!1}}return S(()=>{C()}),(a,i)=>{const f=U("router-link");return r(),o("div",W,[t("div",T,[t("div",j,[t("h2",null,d(h?"Edit Artist":"Create Artist"),1),b(f,{class:"btn-cancel",to:"/admin/artists"},{default:y(()=>[k("Cancel")]),_:1})]),t("form",{class:"artist-form",onSubmit:x(V,["prevent"])},[b(R,{modelValue:e.value,"onUpdate:modelValue":i[0]||(i[0]=p=>e.value=p)},{"image-field":y(()=>[t("div",z,[D,t("input",{id:"image",type:"file",accept:"image/*",onChange:I},null,32),M])]),_:1},8,["modelValue"]),s.value?(r(),o("div",Y,d(s.value),1)):u("",!0),t("div",O,[t("button",{class:"btn-primary",type:"submit",disabled:m.value},d(m.value?"Saving...":h?"Update Artist":"Create Artist"),9,q),b(f,{class:"btn-secondary",to:"/admin/artists"},{default:y(()=>[k("Cancel")]),_:1})])],32)]),t("div",G,[H,t("div",J,[t("h2",K,d(e.value.name||"Artist Name"),1),g.value?(r(),o("img",{key:0,class:"artist-img",src:g.value},null,8,Q)):u("",!0),e.value.link?(r(),o("a",{key:1,href:e.value.link},"Band website",8,X)):u("",!0),t("p",null,d(e.value.description),1),e.value.youtube&&e.value.youtube.startsWith("https://www.youtube.com/embed/")?(r(),o("div",Z,[t("iframe",{class:"youtube",src:e.value.youtube,title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",referrerpolicy:"strict-origin-when-cross-origin",allowfullscreen:""},null,8,$)])):u("",!0),e.value.bandcamp&&e.value.bandcamp.startsWith("https://bandcamp.com/EmbeddedPlayer")?(r(),o("div",ee,[t("iframe",{class:"bandcamp",src:e.value.bandcamp,title:"Bandcamp player",frameborder:"0",width:"350px",height:"470px",seamless:""},null,8,te)])):u("",!0)])])])}}}),le=P(ae,[["__scopeId","data-v-3c85f639"]]);export{le as default};
